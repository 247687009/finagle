<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>FAQ &mdash; Finagle 6.12.2 documentation</title>
    
    <link rel="stylesheet" href="_static/finagle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '6.12.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Finagle 6.12.2 documentation" href="index.html" />
    <link rel="next" title="Finagle changelog" href="changelog.html" />
    <link rel="prev" title="Metrics" href="Metrics.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="_static/small_flask.css" type= "text/css" rel="stylesheet" />

  </head>
  <body>
  
  

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="changelog.html" title="Finagle changelog"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Metrics.html" title="Metrics"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Finagle</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="faq">
<h1>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-s-a-cancelledrequestexception">
<h2>What&#8217;s a <cite>CancelledRequestException</cite>?<a class="headerlink" href="#what-s-a-cancelledrequestexception" title="Permalink to this headline">¶</a></h2>
<p>When a client connected to a Finagle server disconnects, the server raises
a <em>cancellation</em> interrupt on the pending Future. This is done to
conserve resources and avoid unnecessary work: the upstream
client may have timed the request out, for example. Interrupts on
futures propagate, and so if that server is in turn waiting for a response
from a downstream server it will cancel this pending request, and so on.</p>
<p>This is the source of the <a class="reference external" href="http://twitter.github.com/finagle/docs/#com.twitter.finagle.CancelledRequestException">CancelledRequestException</a> &#8211;
when a Finagle client receives the cancellation interrupt while a request is pending, it
fails that request with this exception.</p>
<p>You can disable this behavior by using the <a class="reference external" href="http://twitter.github.com/finagle/docs/#com.twitter.finagle.filter.MaskCancelFilter">MaskCancelFilter</a>:</p>
<div class="highlight-text"><div class="highlight"><pre>val service: Service[Req, Rep] = ...
val masked = new MaskCancelFilter[Req, Rep]

val maskedService = masked andThen service
</pre></div>
</div>
<p>Note that most protocols do not natively support request cancellations
(though modern RPC protocols like <a class="reference external" href="http://twitter.github.com/finagle/docs/#com.twitter.finagle.Mux$">Mux</a>
do). In practice, this means that for these protocols, we need to disconnect
the client to signal cancellation, which in turn can cause undue connection
churn.</p>
</div>
<div class="section" id="why-is-com-twitter-common-zookeeper-server-set-not-found">
<h2>Why is &#8220;com.twitter.common.zookeeper#server-set&#8221; not found?<a class="headerlink" href="#why-is-com-twitter-common-zookeeper-server-set-not-found" title="Permalink to this headline">¶</a></h2>
<p>Some of our libraries still aren&#8217;t published to maven central.  If you add</p>
<div class="highlight-text"><div class="highlight"><pre>resolvers += &quot;twitter&quot; at &quot;http://maven.twttr.com&quot;
</pre></div>
</div>
<p>to your sbt configuration, it will be able to pick up the libraries which are
published externally, but not yet to maven central.</p>
</div>
<div class="section" id="how-do-i-change-my-timeouts-in-the-finagle-6-apis">
<h2>How do I change my timeouts in the Finagle 6 APIs?<a class="headerlink" href="#how-do-i-change-my-timeouts-in-the-finagle-6-apis" title="Permalink to this headline">¶</a></h2>
<p>We introduced a new, preferred API for constructing Finagle <cite>Client`s and `Server`s.
Where the old API used `ServerBuilder</cite>/<cite>ClientBuilder</cite> with Codecs, the new APIs use
<cite>Proto.newClient</cite>.</p>
<p>Old APIs:</p>
<div class="highlight-text"><div class="highlight"><pre>val client = ClientBuilder
  .codec(Http)
  .hosts(&quot;localhost:10000,localhost:10001,localhost:10003&quot;)
  .hostConnectionLimit(1)
  .build()
</pre></div>
</div>
<p>New APIs:</p>
<div class="highlight-text"><div class="highlight"><pre>val client = Http.newService(&quot;localhost:10000,localhost:10001&quot;)
</pre></div>
</div>
<p>The new APIs make timeouts more explicit, but we think we have a pretty good reason
for changing the API this way.</p>
<p>Timeouts are typically used in two cases:</p>
<ol class="upperalpha simple">
<li>Liveness detection (tcp connect timeout)</li>
<li>Application requirements (global timeout)</li>
</ol>
<p>For liveness detection, it is actually fine for timeouts to be long.  We have a
default of 1 second.</p>
<p>For application requirements, you can use a service normally and then use
<cite>Future#raiseWithin</cite>.</p>
<div class="highlight-text"><div class="highlight"><pre>val get: Future[HttpResponse] = Http.fetchUrl(&quot;https://twitter.com/&quot;)
get.raiseWithin(1.ms)
</pre></div>
</div>
<p>We found that having all of the extremely granular timeouts was making it harder
for people to use Finagle, since it was hard to reason about what all of the
timeouts did without knowledge of Finagle internals.  How is <cite>tcpConnectTimeout</cite>
different from <cite>connectTimeout</cite>?  How is a <cite>requestTimeout</cite> different from a
<cite>timeout</cite>?  What is an <cite>idleReaderTimeout</cite>?  How is it different from
<cite>idleWriterTimeout</cite>?  People would often cargo-cult bad configuration settings,
and it would be difficult to recover from the bad situation.  We also found that
they were rarely being used correctly, and usually only by very sophisticated
users.</p>
<p>We&#8217;re encouraging users to avoid encoding application requirements in Finagle,
which was previously too easy to do via methods like <cite>ClientBuilder#retries</cite>, or
<cite>ClientBuilder#timeout</cite>.  These are fundamentally application-level concerns&#8211;
you&#8217;re trying to meet an SLA, etc.  In general, in order to do what Finagle is
for, which is to deliver an rpc message to a cluster, we don&#8217;t think you should
need a lot of configuration at all.  You should need to specify your protocol,
and a few details about the transport (ssl?  no ssl?), but that&#8217;s about it.</p>
<p>Of course, there are some points where there are rough edges, and we haven&#8217;t
figured out exactly what the right default should be.  We&#8217;re actively looking
for input, and would love for the greater Finagle community to help us find good
defaults.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="index.html">
  <img class="logo" src="_static/logo_small.png" alt="Logo"/>
</a></p><a href="index.html"><h3>Finagle</h3></a>
<p>
  Finagle is a network stack for distributed systems.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="http://github.com/twitter/finagle">Finagle @ GitHub</a></li>
  <li><a href="http://github.com/twitter/finagle/issues">Issue Tracker</a></li>
</ul>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">FAQ</a><ul>
<li><a class="reference internal" href="#what-s-a-cancelledrequestexception">What&#8217;s a <cite>CancelledRequestException</cite>?</a></li>
<li><a class="reference internal" href="#why-is-com-twitter-common-zookeeper-server-set-not-found">Why is &#8220;com.twitter.common.zookeeper#server-set&#8221; not found?</a></li>
<li><a class="reference internal" href="#how-do-i-change-my-timeouts-in-the-finagle-6-apis">How do I change my timeouts in the Finagle 6 APIs?</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Metrics.html" title="previous chapter">Metrics</a></li>
      <li>Next: <a href="changelog.html" title="next chapter">Finagle changelog</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2013 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  
  </body>
</html>